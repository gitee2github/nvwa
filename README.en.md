# nvwa

#### Introduction

nvwa is a tool used for automated hot upgrades of openEuler.

#### Construction Mode

```
cd src
go get nvwa
go build
```

#### About Configuration

Configuration files are stored in the **config** directory. During running, the binary system searches for the configuration files in three directories in the following sequence:

1. Run directory
2. **config** subdirectory in the run directory
3. **/etc/nvwa**

The configuration files include:

1. **nvwa-restore.yaml**

Processes and services that need to be restored onsite. For each service, nvwa modifies the systemd configuration and restores the running status through systemd.

2. **nvwa-server.yaml**

Directories, logs, and binary directory configurations required for hot upgrades.


#### Supported Commands

- **nvwa update** -- the target kernel version of a hot upgrade. (Related files must be stored in **/boot**.)

  nvwa searches for the required kernel and rootfs in the **/boot** directory. The kernel must be named in the **vmlinuz-<version>** format, and the rootfs must be named in the **initramfs-<version>.img** format.

+ **nvwa help**

    Displays the help information about the client.

+ **nvwa init**

    Deletes the images generated by nvwa and modifications on the service.

## Restrictions on Restoring the Service

The standard output and error output of the service must be set to files.
The pid occupation error may occur during service restoration.

## nvwa Run Log Check

> service nvwa status

## Development Plan

+ Manage the logs of **criu/kexec/nvwa** in a centralized manner.
+ Print the timestamps and automatically calculate the delay.

## Kernel Boot Acceleration Patch
+ The patch is stored in the patches directory. Different kernel versions have different patch sets.